**ls -l**
-: 普通文件
d: 目录
l: 符号链接
b: 块设备文件
c: 字符设备文件
p: 命名管道 (FIFO)
s: 套接字 (Socket)



**总结:**

| 特性         | `stat`                                   | `lstat`                                  | `fstatat`                                                                |
|--------------|-------------------------------------------|-------------------------------------------|-------------------------------------------------------------------------|
| 核心功能     | 获取文件/目录状态信息                      | 获取文件/目录状态信息                      | 获取文件/目录状态信息                                                   |
| 符号链接处理 | **跟随**                                   | **不跟随**                                 | 由 `flags` 控制：跟随 (默认) 或不跟随 (`AT_SYMLINK_NOFOLLOW`)              |
| 路径解析     | 相对于当前工作目录或绝对路径              | 相对于当前工作目录或绝对路径              | 相对于当前工作目录 (使用 `AT_FDCWD`) 或由 `dirfd` 指定的目录或绝对路径 |
| 主要用途     | 获取目标文件的属性                       | 获取符号链接本身的属性                   | 更安全、原子性的文件操作，可灵活控制符号链接跟随                         |
| 参数 `dirfd` | 无                                        | 无                                        | 指定相对路径解析的起始目录                                              |
| 参数 `flags` | 无                                        | 无                                        | 控制符号链接跟随行为                                                      |



`chmod -X`: 为目录添加执行权限，文件不添加
`chmod -R`: 递归修改目录下的所有文件和子目录的权限



```
lzww@lzww-VMware-Virtual-Platform:~/Desktop/Unix-Programming/File&Directory$ umask
0002
lzww@lzww-VMware-Virtual-Platform:~/Desktop/Unix-Programming/File&Directory$ umask -S
u=rwx,g=rwx,o=rx
```

* 当你只输入 `umask` 命令而不带任何参数时，它会显示当前用户的 `umask` 值。
* `0002` 是一个八进制数，表示当前的 `umask` 设置。
* 从右到左，每一位数字分别代表：
    * **最后一位 (2):**  针对**其他用户 (others)** 的权限。八进制的 `2` 对应二进制的 `010`，表示**禁止其他用户拥有写权限**。
    * **中间一位 (0):** 针对**所属组用户 (group)** 的权限。八进制的 `0` 对应二进制的 `000`，表示**不禁止所属组用户的任何权限**。
    * **第一位 (0):** 针对**文件所有者 (user)** 的权限。八进制的 `0` 对应二进制的 `000`，表示**不禁止文件所有者的任何权限**。
    * **最前面一位 (0):**  表示特殊权限位（SetUID, SetGID, Sticky bit），这里没有屏蔽任何特殊权限。



**对比 `link()` 和 `symlink()`:**

| 特性         | 硬链接 (`link()`) | 软链接 (`symlink()`) |
|--------------|-------------------|-----------------------|
| 本质         | 指向同一个 inode  | 包含目标文件路径的特殊文件 |
| inode        | 共享              | 独立                |
| 数据共享     | 共享              | 不共享 (间接访问)     |
| 跨文件系统   | 否                | 是                    |
| 删除原始文件 | 不影响其他硬链接  | 软链接失效            |


**`*at` 函数原子性:**
1. **单个操作的原子性：**  即使路径名解析是原子的，`*at` 函数执行的**实际文件操作**本身，例如 `openat` 中的打开文件、`renameat` 中的重命名文件，其原子性取决于底层的系统调用和文件系统的实现。  一般来说，许多基本的文件系统操作（如单个文件的创建、删除、重命名）在现代操作系统中是原子性的，但这并非绝对保证。

2. **多个 `*at` 函数调用：**  连续调用多个 `*at` 函数并不能保证整体的原子性。 例如，先使用 `openat` 打开一个文件，再使用 `fchmodat` 修改其权限，这两个操作是独立的，中间可能发生其他操作。

3. **数据访问的原子性：**  `*at` 函数主要关注路径名解析和文件元数据的操作。  对于文件内容的读写操作，仍然需要使用适当的同步机制（如互斥锁、读写锁）来保证数据访问的原子性。